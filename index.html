<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Dashboard Web3</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.8.2/dist/web3.min.js"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f7f7f7; color: #333; }
    button { padding: 10px 20px; font-size: 16px; }
    .card { background: #fff; border-radius: 8px; padding: 20px; margin: 20px 0; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    h2 { color: #2c3e50; }
    .adresse { font-weight: bold; }
  </style>
</head>
<body>
  <div class="card">
    <h2>Dashboard Web3</h2>
    <button onclick="connecterMetamask()">ðŸ”— Connecter MetaMask</button>
    <p class="adresse" id="adresse">Adresse : Non connectÃ©e</p>
    <p id="solde">Solde ETH : -</p>
    <p id="estimation">Estimation en $ : -</p>
  </div>

  <div class="card">
    <h2>Tokens ERC-20</h2>
    <ul id="tokens">Chargement...</ul>
  </div>

  <div class="card">
    <h2>NFTs</h2>
    <ul id="nfts">Chargement...</ul>
  </div>

  <div class="card">
    <h2>Transactions rÃ©centes</h2>
    <ul id="transactions">Chargement...</ul>
  </div>

<script>
const MORALIS_API_KEY = "Votre_clÃ©_API_Moralis_ici";

async function connecterMetamask() {
  if (window.ethereum) {
    try {
      const comptes = await window.ethereum.request({ method: 'eth_requestAccounts' });
      const adresse = comptes[0];
      document.getElementById("adresse").innerText = "Adresse : " + adresse;

      const web3 = new Web3(window.ethereum);
      const soldeWei = await web3.eth.getBalance(adresse);
      const soldeETH = web3.utils.fromWei(soldeWei, "ether");
      document.getElementById("solde").innerText = "Solde ETH : " + parseFloat(soldeETH).toFixed(4);

      const ethUSD = await axios.get("https://api.coingecko.com/api/v3/simple/price?ids=ethereum&vs_currencies=usd");
      const prixUSD = ethUSD.data.ethereum.usd;
      document.getElementById("estimation").innerText = "Estimation en $ : " + (soldeETH * prixUSD).toFixed(2);

      chargerERC20(adresse);
      chargerNFTs(adresse);
      chargerTransactions(adresse);

    } catch (error) {
      alert("Erreur connexion : " + error.message);
    }
  } else {
    alert("MetaMask non dÃ©tectÃ© !");
  }
}

async function chargerERC20(adresse) {
  const url = `https://deep-index.moralis.io/api/v2.2/${adresse}/erc20`;
  try {
    const res = await axios.get(url, {
      headers: { "X-API-Key": MORALIS_API_KEY }
    });
    const liste = document.getElementById("tokens");
    liste.innerHTML = "";
    res.data.forEach(token => {
      const li = document.createElement("li");
      li.textContent = `${token.name} (${token.symbol}) : ${token.balance / 10 ** token.decimals}`;
      liste.appendChild(li);
    });
  } catch (e) {
    document.getElementById("tokens").innerText = "Erreur de chargement";
  }
}

async function chargerNFTs(adresse) {
  const url = `https://deep-index.moralis.io/api/v2.2/${adresse}/nft?chain=eth&format=decimal`;
  try {
    const res = await axios.get(url, {
      headers: { "X-API-Key": MORALIS_API_KEY }
    });
    const liste = document.getElementById("nfts");
    liste.innerHTML = "";
    res.data.result.forEach(nft => {
      const li = document.createElement("li");
      li.textContent = `NFT ${nft.name || nft.token_id}`;
      liste.appendChild(li);
    });
  } catch (e) {
    document.getElementById("nfts").innerText = "Erreur de chargement";
  }
}

async function chargerTransactions(adresse) {
  const url = `https://deep-index.moralis.io/api/v2.2/${adresse}?chain=eth`;
  try {
    const res = await axios.get(url, {
      headers: { "X-API-Key": MORALIS_API_KEY }
    });
    const liste = document.getElementById("transactions");
    liste.innerHTML = "";
    res.data.result.slice(0, 5).forEach(tx => {
      const li = document.createElement("li");
      li.textContent = `Tx vers ${tx.to} : ${(tx.value / 1e18).toFixed(4)} ETH`;
      liste.appendChild(li);
    });
  } catch (e) {
    document.getElementById("transactions").innerText = "Erreur de chargement";
  }
}
</script>
</body>
</html>