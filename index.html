
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mon Dashboard Web3</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .section { margin-bottom: 30px; }
    .token, .nft { margin-top: 10px; }
    button { padding: 10px; margin-top: 10px; }
  </style>
</head>
<body>
  <h1>Dashboard Web3</h1>
  <div class="section">
    <button onclick="connectWallet()">🔗 Connecter MetaMask</button>
    <p id="walletAddress">Adresse : Non connectée</p>
    <p id="ethBalance">Solde ETH : --</p>
    <p id="usdBalance">Estimation en $ : --</p>
  </div>

  <div class="section">
    <h2>Tokens ERC-20</h2>
    <div id="tokens">Chargement...</div>
  </div>

  <div class="section">
    <h2>NFTs</h2>
    <div id="nfts">Chargement...</div>
  </div>

  <div class="section">
    <h2>Transactions récentes</h2>
    <div id="transactions">Chargement...</div>
  </div>

  <script>
    const MORALIS_API = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJub25jZSI6IjczODk1YWRjLThiMmYtNGVhNi1hYjkyLTk1ZDEyMzE3NTE1MyIsIm9yZ0lkIjoiNDU4MTA3IiwidXNlcklkIjoiNDcxMzEzIiwidHlwZUlkIjoiYzhlZTI0MWMtYTg0My00OWRhLWJkZmUtNzg0ZThhODE4Y2ViIiwidHlwZSI6IlBST0pFQ1QiLCJpYXQiOjE3NTE5MjMzNDcsImV4cCI6NDkwNzY4MzM0N30.5RcKbgyOhBrYirRGhK15qvE3VOj1ieOn_r6yhJTQzOE";

    let userAddress = "";

    async function connectWallet() {
      if (window.ethereum) {
        const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
        userAddress = accounts[0];
        document.getElementById("walletAddress").innerText = "Adresse : " + userAddress;
        getEthBalance();
        getTokens();
        getNFTs();
        getTransactions();
      } else {
        alert("MetaMask n’est pas installé !");
      }
    }

    async function getEthBalance() {
      const web3 = new Web3(window.ethereum);
      const balance = await web3.eth.getBalance(userAddress);
      const eth = web3.utils.fromWei(balance, "ether");
      document.getElementById("ethBalance").innerText = `Solde ETH : ${eth}`;
      document.getElementById("usdBalance").innerText = `Estimation en $ : ${(eth * 3200).toFixed(2)}`;
    }

    async function getTokens() {
      try {
        const res = await axios.get(`https://deep-index.moralis.io/api/v2.2/${userAddress}/erc20`, {
          headers: { "X-API-Key": MORALIS_API }
        });
        const container = document.getElementById("tokens");
        container.innerHTML = "";
        res.data.forEach(token => {
          const amount = token.balance / (10 ** token.decimals);
          container.innerHTML += `<div class='token'>🔹 ${token.name} (${token.symbol}) : ${amount}</div>`;
        });
        if (res.data.length === 0) container.innerHTML = "Aucun token trouvé.";
      } catch {
        document.getElementById("tokens").innerText = "Erreur lors du chargement des tokens.";
      }
    }

    async function getNFTs() {
      try {
        const res = await axios.get(`https://deep-index.moralis.io/api/v2.2/${userAddress}/nft`, {
          headers: { "X-API-Key": MORALIS_API }
        });
        const container = document.getElementById("nfts");
        container.innerHTML = "";
        res.data.result.forEach(nft => {
          container.innerHTML += `<div class='nft'>🎨 ${nft.name || "NFT"} (token ID: ${nft.token_id})</div>`;
        });
        if (res.data.result.length === 0) container.innerHTML = "Aucun NFT trouvé.";
      } catch {
        document.getElementById("nfts").innerText = "Erreur lors du chargement des NFTs.";
      }
    }

    async function getTransactions() {
      try {
        const res = await axios.get(`https://deep-index.moralis.io/api/v2.2/${userAddress}`, {
          headers: { "X-API-Key": MORALIS_API }
        });
        const txs = res.data.result || [];
        const container = document.getElementById("transactions");
        container.innerHTML = "";
        txs.slice(0, 5).forEach(tx => {
          container.innerHTML += `<div>🔁 ${tx.hash.substring(0, 10)}... → <a href='https://etherscan.io/tx/${tx.hash}' target='_blank'>Voir</a></div>`;
        });
        if (txs.length === 0) container.innerHTML = "Aucune transaction récente.";
      } catch {
        document.getElementById("transactions").innerText = "Erreur lors du chargement des transactions.";
      }
    }
  </script>
</body>
</html>
